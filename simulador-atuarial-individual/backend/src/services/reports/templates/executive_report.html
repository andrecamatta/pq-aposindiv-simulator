<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Executivo - Simula√ß√£o Atuarial Individual</title>
    <style>
        /* CSS inline para garantir compatibilidade com WeasyPrint */
        @page {
            size: A4;
            margin: 2cm 1.5cm;
            @top-center {
                content: "{{ config.company_name }}";
                font-size: 10px;
                color: #666;
            }
            @bottom-center {
                content: "P√°gina " counter(page) " de " counter(pages);
                font-size: 10px;
                color: #666;
            }
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 11px;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .page-break { page-break-after: always; }
        .no-break { page-break-inside: avoid; }

        h1 {
            font-size: 18px;
            text-align: center;
            margin-bottom: 1em;
            padding-bottom: 0.5em;
            border-bottom: 2px solid #3498db;
            color: #2c3e50;
        }

        h2 {
            font-size: 16px;
            margin: 1.5em 0 0.8em 0;
            color: #2980b9;
        }

        h3 {
            font-size: 14px;
            margin: 1em 0 0.6em 0;
            color: #2c3e50;
        }

        h4 {
            font-size: 12px;
            margin-bottom: 0.4em;
            color: #2c3e50;
        }

        .participant-info {
            background: #f8f9fa;
            padding: 1em;
            border-radius: 8px;
            margin-bottom: 1.5em;
            border-left: 4px solid #3498db;
        }

        .participant-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1em;
        }

        .participant-grid p {
            margin: 0.4em 0;
            font-size: 10px;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1em;
            margin: 1em 0;
        }

        .kpi-card {
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            padding: 1em;
            text-align: center;
            background: #f8f9fa;
        }

        .kpi-card h3 {
            font-size: 11px;
            color: #7f8c8d;
            text-transform: uppercase;
            margin-bottom: 0.5em;
        }

        .kpi-value {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.3em;
        }

        .kpi-value.positive { color: #27ae60; }
        .kpi-value.negative { color: #e74c3c; }

        .kpi-card small {
            font-size: 9px;
            color: #95a5a6;
            display: block;
        }

        .situation-banner {
            padding: 1em;
            border-radius: 6px;
            margin: 1em 0;
            font-weight: bold;
            text-align: center;
        }

        .situation-banner.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .situation-banner.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #a6d2ff;
        }

        .situation-banner.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .situation-banner.danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .chart-container {
            text-align: center;
            margin: 1.5em 0;
            page-break-inside: avoid;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #e1e8ed;
            border-radius: 4px;
        }

        .recommendation {
            margin: 1em 0;
            padding: 1em;
            border-radius: 6px;
            border-left: 4px solid;
            page-break-inside: avoid;
        }

        .recommendation h4 {
            margin-bottom: 0.5em;
            font-size: 12px;
        }

        .recommendation p {
            margin: 0;
            font-size: 10px;
            line-height: 1.4;
        }

        .recommendation.success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .recommendation.info {
            background: #cce7ff;
            border-left-color: #17a2b8;
            color: #004085;
        }

        .recommendation.warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }

        .recommendation.danger {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .conclusion {
            background: #f8f9fa;
            padding: 1.5em;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin: 2em 0;
        }

        .technical-note {
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            padding: 1em;
            margin: 2em 0;
            font-size: 9px;
            color: #6c757d;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
            font-size: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 0.5em;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <!-- P√°gina 1: Capa e Resumo Executivo -->
    <div class="header">
        <h1>RELAT√ìRIO EXECUTIVO<br>SIMULA√á√ÉO ATUARIAL INDIVIDUAL</h1>
        <div class="subtitle">
            <strong>Tipo de Plano:</strong> {{ 'Contribui√ß√£o Definida (CD)' if is_cd else 'Benef√≠cio Definido (BD)' }}<br>
            <strong>Data da Simula√ß√£o:</strong> {{ generation_date }}<br>
            <strong>Participante:</strong> {{ 'Masculino' if state.gender == 'M' else 'Feminino' }}, {{ state.age }} anos
        </div>
    </div>

    <!-- Situa√ß√£o Geral -->
    <div class="situation-banner {{ situation.color }}">
        <strong>Situa√ß√£o Geral: {{ situation.status }}</strong><br>
        {{ situation.description }}
    </div>

    <!-- Dados do Participante -->
    <div class="participant-info no-break">
        <h2>Dados do Participante e Premissas</h2>
        <div class="participant-grid">
            <div>
                <p><strong>Idade Atual:</strong> {{ state.age }} anos</p>
                <p><strong>Idade de Aposentadoria:</strong> {{ state.retirement_age }} anos</p>
                <p><strong>Sal√°rio Mensal:</strong> {{ state.salary | currency }}</p>
                <p><strong>Saldo Inicial:</strong> {{ state.initial_balance | currency }}</p>
                <p><strong>Taxa de Contribui√ß√£o:</strong> {{ state.contribution_rate | percentage }}</p>
            </div>
            <div>
                <p><strong>T√°bua de Mortalidade:</strong> {{ state.mortality_table }}</p>
                {% if is_cd %}
                <p><strong>Taxa de Acumula√ß√£o:</strong> {{ (state.accumulation_rate * 100) | percentage }} a.a.</p>
                <p><strong>Taxa de Convers√£o:</strong> {{ (state.conversion_rate * 100) | percentage }} a.a.</p>
                <p><strong>Modalidade CD:</strong> {{ state.cd_conversion_mode or 'ACTUARIAL' }}</p>
                {% else %}
                <p><strong>Taxa de Desconto:</strong> {{ (state.discount_rate * 100) | percentage }} a.a.</p>
                <p><strong>Crescimento Salarial:</strong> {{ (state.salary_growth_real * 100) | percentage }} a.a.</p>
                <p><strong>M√©todo de C√°lculo:</strong> {{ state.calculation_method or 'PUC' }}</p>
                {% endif %}
                <p><strong>Benef√≠cios por Ano:</strong> {{ state.benefit_months_per_year or 13 }}x</p>
            </div>
        </div>
    </div>

    <!-- KPIs Principais -->
    <div class="kpi-section no-break">
        <h2>üìä Indicadores Principais</h2>
        <div class="kpi-grid">
            {% if is_cd %}
            <!-- KPIs para CD -->
            <div class="kpi-card">
                <h3>Saldo Acumulado</h3>
                <div class="kpi-value">{{ kpis.saldo_final | currency(0) }}</div>
                <small>Valor total na aposentadoria</small>
            </div>
            <div class="kpi-card">
                <h3>Renda Mensal CD</h3>
                <div class="kpi-value">{{ kpis.renda_mensal | currency(0) }}</div>
                <small>{{ kpis.modalidade_conversao }}</small>
            </div>
            <div class="kpi-card">
                <h3>Taxa de Reposi√ß√£o</h3>
                <div class="kpi-value {{ 'positive' if kpis.taxa_reposicao >= kpis.taxa_reposicao_meta else 'negative' }}">
                    {{ kpis.taxa_reposicao | percentage }}
                </div>
                <small>Meta: {{ kpis.taxa_reposicao_meta | percentage }}</small>
            </div>
            <div class="kpi-card">
                <h3>Rendimento Total</h3>
                <div class="kpi-value">{{ kpis.rendimento_total | currency(0) }}</div>
                <small>Ganho com investimentos</small>
            </div>
            {% else %}
            <!-- KPIs para BD -->
            <div class="kpi-card">
                <h3>RMBA</h3>
                <div class="kpi-value">{{ kpis.rmba | currency(0) }}</div>
                <small>Reserva Matem√°tica de Benef√≠cios a Conceder</small>
            </div>
            <div class="kpi-card">
                <h3>RMBC</h3>
                <div class="kpi-value">{{ kpis.rmbc | currency(0) }}</div>
                <small>Reserva Matem√°tica de Benef√≠cios Concedidos</small>
            </div>
            <div class="kpi-card">
                <h3>Super√°vit/D√©ficit</h3>
                <div class="kpi-value {{ 'positive' if kpis.deficit_surplus >= 0 else 'negative' }}">
                    {{ kpis.deficit_surplus | currency(0) }}
                </div>
                <small>{{ kpis.deficit_surplus_pct | percentage }} do patrim√¥nio</small>
            </div>
            <div class="kpi-card">
                <h3>Taxa de Reposi√ß√£o</h3>
                <div class="kpi-value">{{ kpis.taxa_reposicao | percentage }}</div>
                <small>Meta: {{ kpis.taxa_reposicao_meta | percentage }}</small>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Gr√°fico Principal -->
    {% if charts.reserve_evolution %}
    <div class="chart-container no-break">
        <h3>{{ 'Evolu√ß√£o do Saldo Individual' if is_cd else 'Evolu√ß√£o das Reservas Matem√°ticas' }}</h3>
        <img src="{{ charts.reserve_evolution }}" alt="Evolu√ß√£o das Reservas">
    </div>
    {% endif %}

    <div class="page-break"></div>

    <!-- P√°gina 2: An√°lise Detalhada -->
    <h2>üìà An√°lise Detalhada</h2>

    <!-- Gr√°fico de Sensibilidade -->
    {% if charts.sensitivity_analysis %}
    <div class="chart-container no-break">
        <h3>An√°lise de Sensibilidade</h3>
        <img src="{{ charts.sensitivity_analysis }}" alt="An√°lise de Sensibilidade">
        <p style="font-size: 9px; color: #666; margin-top: 0.5em;">
            Impacto das principais vari√°veis nos resultados da simula√ß√£o
        </p>
    </div>
    {% endif %}

    <!-- Gr√°fico de Proje√ß√µes -->
    {% if charts.projections_summary %}
    <div class="chart-container no-break">
        <h3>Proje√ß√µes Financeiras</h3>
        <img src="{{ charts.projections_summary }}" alt="Proje√ß√µes Financeiras">
    </div>
    {% endif %}

    <div class="page-break"></div>

    <!-- P√°gina 3: Recomenda√ß√µes e Conclus√µes -->
    <h2>üí° Recomenda√ß√µes e Conclus√µes</h2>

    <!-- Recomenda√ß√µes -->
    <div class="recommendations-section">
        <h3>Principais Recomenda√ß√µes</h3>
        {% for recommendation in recommendations %}
        <div class="recommendation {{ recommendation.type }}">
            <h4>{{ recommendation.title }}</h4>
            <p>{{ recommendation.description }}</p>
        </div>
        {% endfor %}
    </div>

    <!-- Conclus√£o Executiva -->
    <div class="conclusion no-break">
        <h3>Conclus√£o Executiva</h3>
        {% if is_cd %}
        <p>
            A simula√ß√£o projeta um saldo acumulado de <strong>{{ kpis.saldo_final | currency(0) }}</strong>
            na aposentadoria, resultando em uma renda mensal estimada de <strong>{{ kpis.renda_mensal | currency(0) }}</strong>,
            que representa <strong>{{ kpis.taxa_reposicao | percentage }}</strong> do sal√°rio final.
        </p>
        {% if kpis.taxa_reposicao >= kpis.taxa_reposicao_meta %}
        <p>
            A taxa de reposi√ß√£o projetada atende ou supera a meta estabelecida de {{ kpis.taxa_reposicao_meta | percentage }},
            indicando adequa√ß√£o da estrat√©gia atual de contribui√ß√£o e acumula√ß√£o.
        </p>
        {% else %}
        <p>
            A taxa de reposi√ß√£o projetada fica abaixo da meta de {{ kpis.taxa_reposicao_meta | percentage }},
            sugerindo a necessidade de ajustes na estrat√©gia de contribui√ß√£o ou revis√£o das expectativas.
        </p>
        {% endif %}
        {% else %}
        <p>
            O plano apresenta uma RMBA de <strong>{{ kpis.rmba | currency(0) }}</strong> e
            {% if kpis.deficit_surplus >= 0 %}
            um super√°vit de <strong>{{ kpis.deficit_surplus | currency(0) }}</strong>,
            indicando sustentabilidade das contribui√ß√µes atuais.
            {% else %}
            um d√©ficit de <strong>{{ (-kpis.deficit_surplus) | currency(0) }}</strong>,
            requerendo ajustes para garantir a sustentabilidade do plano.
            {% endif %}
        </p>
        <p>
            A taxa de contribui√ß√£o necess√°ria para o equil√≠brio atuarial √© de
            <strong>{{ kpis.contribuicao_necessaria | percentage }}</strong>, comparada aos
            <strong>{{ kpis.contribuicao_atual | percentage }}</strong> atualmente estabelecidos.
        </p>
        {% endif %}
    </div>

    <!-- Gr√°fico de Fluxo de Caixa -->
    {% if charts.cash_flow %}
    <div class="chart-container no-break">
        <h3>Fluxo de Caixa Projetado</h3>
        <img src="{{ charts.cash_flow }}" alt="Fluxo de Caixa">
    </div>
    {% endif %}

    <!-- Nota T√©cnica -->
    <div class="technical-note">
        <h4>üìã Nota T√©cnica</h4>
        <p>
            <strong>Metodologia:</strong> Este relat√≥rio foi gerado com base nas premissas atuariais informadas
            e utiliza a t√°bua de mortalidade {{ state.mortality_table }}. Os c√°lculos seguem metodologia
            {{ state.calculation_method or 'PUC' }} e princ√≠pios atuariais reconhecidos.
        </p>
        <p>
            <strong>Limita√ß√µes:</strong> Os resultados s√£o v√°lidos para as condi√ß√µes especificadas e
            est√£o sujeitos a varia√ß√µes conforme mudan√ßas nas condi√ß√µes econ√¥micas, demogr√°ficas e regulat√≥rias.
            Recomenda-se revis√£o peri√≥dica das premissas e acompanhamento atuarial especializado.
        </p>
        <p>
            <strong>Gera√ß√£o:</strong> Relat√≥rio gerado em {{ generation_date }} ‚Ä¢
            Tempo de processamento: {{ results.computation_time_ms or 0 }}ms ‚Ä¢
            Simulador Atuarial Individual v1.0
        </p>
    </div>
</body>
</html>