<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio T√©cnico Atuarial - Simula√ß√£o Individual</title>
    <style>
        /* CSS inline para garantir compatibilidade com WeasyPrint */
        @page {
            size: A4;
            margin: 2cm 1.5cm;
            @top-center {
                content: "{{ config.company_name }} - Relat√≥rio T√©cnico";
                font-size: 10px;
                color: #666;
            }
            @bottom-center {
                content: "P√°gina " counter(page) " de " counter(pages);
                font-size: 10px;
                color: #666;
            }
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 10px;
            line-height: 1.3;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .page-break { page-break-after: always; }
        .no-break { page-break-inside: avoid; }

        h1 {
            font-size: 16px;
            text-align: center;
            margin-bottom: 1em;
            padding-bottom: 0.5em;
            border-bottom: 2px solid #2c5aa0;
            color: #2c3e50;
        }

        h2 {
            font-size: 14px;
            margin: 1.2em 0 0.6em 0;
            color: #2c5aa0;
            border-left: 4px solid #2c5aa0;
            padding-left: 0.5em;
        }

        h3 {
            font-size: 12px;
            margin: 1em 0 0.5em 0;
            color: #2c3e50;
        }

        h4 {
            font-size: 11px;
            margin-bottom: 0.4em;
            color: #2c3e50;
        }

        .header-section {
            background: #f8f9fa;
            padding: 1em;
            border-radius: 6px;
            margin-bottom: 1.5em;
            border-left: 4px solid #2c5aa0;
        }

        .technical-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1em;
            margin: 1em 0;
        }

        .technical-grid p {
            margin: 0.3em 0;
            font-size: 9px;
        }

        .methodology-section {
            background: #fff;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            padding: 1em;
            margin: 1em 0;
        }

        .formula {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 0.8em;
            margin: 0.5em 0;
            font-family: 'Courier New', monospace;
            font-size: 9px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
            font-size: 8px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 0.4em;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
            font-size: 8px;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .assumptions-table {
            font-size: 9px;
        }

        .projections-table {
            font-size: 7px;
        }

        .projections-table th,
        .projections-table td {
            padding: 0.2em;
            text-align: right;
        }

        .chart-container {
            text-align: center;
            margin: 1em 0;
            page-break-inside: avoid;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #e1e8ed;
            border-radius: 4px;
        }

        .kpi-technical {
            background: #f8f9fa;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            padding: 0.8em;
            margin: 0.5em 0;
            text-align: center;
        }

        .kpi-technical h4 {
            font-size: 9px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 0.3em;
        }

        .kpi-technical .value {
            font-size: 12px;
            font-weight: bold;
            color: #2c5aa0;
        }

        .sensitivity-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8em;
            margin: 1em 0;
        }

        .diagnostic {
            padding: 0.8em;
            border-radius: 4px;
            margin: 0.5em 0;
            border-left: 4px solid;
        }

        .diagnostic.good {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .diagnostic.warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }

        .diagnostic.critical {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .technical-note {
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            padding: 0.8em;
            margin: 1em 0;
            font-size: 8px;
            color: #6c757d;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1em;
        }
    </style>
</head>
<body>
    <!-- P√°gina 1: Capa e Metodologia -->
    <div class="header">
        <h1>RELAT√ìRIO T√âCNICO ATUARIAL<br>SIMULA√á√ÉO INDIVIDUAL</h1>
        <div class="subtitle">
            <strong>Tipo de Plano:</strong> {{ 'Contribui√ß√£o Definida (CD)' if is_cd else 'Benef√≠cio Definido (BD)' }}<br>
            <strong>M√©todo de C√°lculo:</strong> {{ state.calculation_method or 'PUC' }}<br>
            <strong>Data da An√°lise:</strong> {{ generation_date }}<br>
            <strong>Participante:</strong> {{ 'Masculino' if state.gender == 'M' else 'Feminino' }}, {{ state.age }} anos
        </div>
    </div>

    <!-- Premissas T√©cnicas Detalhadas -->
    <div class="header-section no-break">
        <h2>üìã Base T√©cnica e Premissas Atuariais</h2>
        <div class="technical-grid">
            <div>
                <h4>Dados do Participante</h4>
                <p><strong>Idade Atual:</strong> {{ state.age }} anos</p>
                <p><strong>G√™nero:</strong> {{ 'Masculino' if state.gender == 'M' else 'Feminino' }}</p>
                <p><strong>Idade de Aposentadoria:</strong> {{ state.retirement_age }} anos</p>
                <p><strong>Tempo at√© Aposentadoria:</strong> {{ state.retirement_age - state.age }} anos</p>
                <p><strong>Sal√°rio Mensal Atual:</strong> {{ state.salary | currency }}</p>
                <p><strong>Sal√°rios por Ano:</strong> {{ state.salary_months_per_year or 13 }}x</p>
                {% if state.initial_balance %}
                <p><strong>Saldo Inicial:</strong> {{ state.initial_balance | currency }}</p>
                {% endif %}
            </div>
            <div>
                <h4>Premissas Atuariais</h4>
                <p><strong>T√°bua de Mortalidade:</strong> {{ state.mortality_table }}</p>
                {% if state.mortality_aggravation %}
                <p><strong>Suaviza√ß√£o:</strong> {{ state.mortality_aggravation | percentage }}</p>
                {% endif %}
                <p><strong>Taxa de Desconto:</strong> {{ (state.discount_rate * 100) | percentage }} a.a.</p>
                <p><strong>Crescimento Salarial Real:</strong> {{ (state.salary_growth_real * 100) | percentage }} a.a.</p>
                <p><strong>Taxa de Contribui√ß√£o:</strong> {{ state.contribution_rate | percentage }}</p>
                {% if state.admin_fee_rate %}
                <p><strong>Taxa de Administra√ß√£o:</strong> {{ (state.admin_fee_rate * 100) | percentage }} a.a.</p>
                {% endif %}
                <p><strong>Regime de Pagamento:</strong> {{ state.payment_timing.title() }}</p>
                <p><strong>Benef√≠cios por Ano:</strong> {{ state.benefit_months_per_year or 13 }}x</p>
            </div>
        </div>
    </div>

    <!-- Metodologia Atuarial -->
    <div class="methodology-section no-break">
        <h2>üî¨ Metodologia Atuarial</h2>

        <h3>M√©todo de C√°lculo: {{ state.calculation_method or 'PUC' }}</h3>
        {% if state.calculation_method == 'PUC' or not state.calculation_method %}
        <p><strong>Projected Unit Credit (PUC):</strong> M√©todo que projeta os benef√≠cios futuros com base no sal√°rio final esperado e calcula o valor presente das obriga√ß√µes.</p>

        <div class="formula">
            <strong>Reserva Matem√°tica de Benef√≠cios a Conceder (RMBA):</strong><br>
            RMBA = Œ£ [Benef√≠cio √ó P(sobreviv√™ncia) √ó v^t]
        </div>

        <div class="formula">
            <strong>Custo Normal Anual:</strong><br>
            CN = (RMBA_final - RMBA_atual) / anos_restantes
        </div>
        {% endif %}

        {% if is_cd %}
        <h3>Modalidade CD: {{ state.cd_conversion_mode or 'ACTUARIAL' }}</h3>
        {% if state.cd_conversion_mode == 'ACTUARIAL_EQUIVALENT' %}
        <p><strong>Equival√™ncia Atuarial:</strong> Benef√≠cio recalculado anualmente com base no saldo remanescente e expectativa de vida atuarial.</p>

        <div class="formula">
            <strong>Benef√≠cio Anual CD (Equival√™ncia Atuarial):</strong><br>
            Benef√≠cio = Saldo_Remanescente / Expectativa_Vida_Atuarial
        </div>
        {% else %}
        <div class="formula">
            <strong>Benef√≠cio Mensal CD:</strong><br>
            Benef√≠cio = (Saldo_Final √ó Taxa_Convers√£o) / 12
        </div>
        {% endif %}
        {% endif %}

        <h3>Taxas e Fatores Utilizados</h3>
        <table class="assumptions-table">
            <thead>
                <tr>
                    <th>Premissa</th>
                    <th>Valor</th>
                    <th>Observa√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Taxa de Desconto</td>
                    <td>{{ (state.discount_rate * 100) | percentage }} a.a.</td>
                    <td>Taxa real, livre de infla√ß√£o</td>
                </tr>
                <tr>
                    <td>Crescimento Salarial</td>
                    <td>{{ (state.salary_growth_real * 100) | percentage }} a.a.</td>
                    <td>Crescimento real acima da infla√ß√£o</td>
                </tr>
                <tr>
                    <td>Mortalidade</td>
                    <td>{{ state.mortality_table }}</td>
                    <td>{% if state.mortality_aggravation %}Com suaviza√ß√£o de {{ state.mortality_aggravation | percentage }}{% else %}Sem suaviza√ß√£o{% endif %}</td>
                </tr>
                <tr>
                    <td>Invalidez</td>
                    <td>N√£o considerada</td>
                    <td>Simplifica√ß√£o metodol√≥gica</td>
                </tr>
                <tr>
                    <td>Rotatividade</td>
                    <td>N√£o considerada</td>
                    <td>Participante permanece at√© aposentadoria</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="page-break"></div>

    <!-- P√°gina 2: Resultados T√©cnicos -->
    <h2>üìä Resultados T√©cnicos Detalhados</h2>

    <!-- KPIs T√©cnicos -->
    <div class="sensitivity-grid">
        {% if is_cd %}
        <div class="kpi-technical">
            <h4>Saldo Acumulado Final</h4>
            <div class="value">{{ (results.individual_balance or 0) | currency(0) }}</div>
        </div>
        <div class="kpi-technical">
            <h4>Contribui√ß√µes Totais</h4>
            <div class="value">{{ (results.total_contributions or 0) | currency(0) }}</div>
        </div>
        <div class="kpi-technical">
            <h4>Rendimentos Acumulados</h4>
            <div class="value">{{ ((results.individual_balance or 0) - (results.total_contributions or 0)) | currency(0) }}</div>
        </div>
        {% else %}
        <div class="kpi-technical">
            <h4>RMBA</h4>
            <div class="value">{{ (results.rmba or 0) | currency(0) }}</div>
        </div>
        <div class="kpi-technical">
            <h4>RMBC</h4>
            <div class="value">{{ (results.rmbc or 0) | currency(0) }}</div>
        </div>
        <div class="kpi-technical">
            <h4>Custo Normal</h4>
            <div class="value">{{ (results.normal_cost or 0) | currency(0) }}</div>
        </div>
        {% endif %}
    </div>

    <!-- Gr√°fico Principal -->
    {% if charts.reserve_evolution %}
    <div class="chart-container no-break">
        <h3>{{ 'Evolu√ß√£o do Saldo Individual (CD)' if is_cd else 'Evolu√ß√£o das Reservas Matem√°ticas (BD)' }}</h3>
        <img src="{{ charts.reserve_evolution }}" alt="Evolu√ß√£o das Reservas">
    </div>
    {% endif %}

    <!-- An√°lise de Adequa√ß√£o -->
    <div class="methodology-section">
        <h3>üéØ An√°lise de Adequa√ß√£o e Sustentabilidade</h3>

        {% if is_cd %}
        {% set replacement_ratio = results.replacement_ratio or 0 %}
        <div class="diagnostic {{ 'good' if replacement_ratio >= 70 else 'warning' if replacement_ratio >= 50 else 'critical' }}">
            <h4>Taxa de Reposi√ß√£o: {{ replacement_ratio | percentage(1) }}</h4>
            <p>
                {% if replacement_ratio >= 70 %}
                Adequada: Taxa de reposi√ß√£o atende aos padr√µes internacionais recomendados (‚â•70%).
                {% elif replacement_ratio >= 50 %}
                Aten√ß√£o: Taxa de reposi√ß√£o moderada, pode requerer complementa√ß√£o.
                {% else %}
                Cr√≠tica: Taxa de reposi√ß√£o abaixo do recomendado, requer revis√£o da estrat√©gia.
                {% endif %}
            </p>
        </div>

        <div class="diagnostic {{ 'good' if state.contribution_rate >= 10 else 'warning' }}">
            <h4>Taxa de Contribui√ß√£o: {{ state.contribution_rate | percentage }}</h4>
            <p>
                {% if state.contribution_rate >= 10 %}
                Adequada: Taxa de contribui√ß√£o consistente com pr√°ticas de mercado.
                {% else %}
                Aten√ß√£o: Taxa de contribui√ß√£o pode ser insuficiente para metas de longo prazo.
                {% endif %}
            </p>
        </div>
        {% else %}
        {% set deficit_surplus = results.deficit_surplus or 0 %}
        <div class="diagnostic {{ 'good' if deficit_surplus >= 0 else 'warning' if deficit_surplus > -100000 else 'critical' }}">
            <h4>Situa√ß√£o Atuarial: {{ 'Super√°vit' if deficit_surplus >= 0 else 'D√©ficit' }} de {{ deficit_surplus | currency(0) }}</h4>
            <p>
                {% if deficit_surplus >= 0 %}
                Situa√ß√£o equilibrada: Reservas suficientes para cobertura das obriga√ß√µes atuariais.
                {% elif deficit_surplus > -100000 %}
                D√©ficit moderado: Requer monitoramento e poss√≠veis ajustes graduais.
                {% else %}
                D√©ficit significativo: A√ß√£o imediata necess√°ria para equil√≠brio atuarial.
                {% endif %}
            </p>
        </div>

        {% set req_contrib_rate = results.required_contribution_rate or 0 %}
        {% set current_contrib_rate = state.contribution_rate or 8 %}
        <div class="diagnostic {{ 'good' if req_contrib_rate <= current_contrib_rate * 1.1 else 'warning' if req_contrib_rate <= current_contrib_rate * 1.3 else 'critical' }}">
            <h4>Taxa de Contribui√ß√£o Necess√°ria: {{ req_contrib_rate | percentage(1) }}</h4>
            <p>
                Atual: {{ current_contrib_rate | percentage(1) }} |
                Diferen√ßa: {{ (req_contrib_rate - current_contrib_rate) | percentage(1) }}
            </p>
        </div>
        {% endif %}
    </div>

    <div class="page-break"></div>

    <!-- P√°gina 3: Proje√ß√µes Detalhadas -->
    <h2>üìà Proje√ß√µes Atuariais Detalhadas</h2>

    <!-- Tabela de Proje√ß√µes -->
    <div class="no-break">
        <h3>Proje√ß√µes Anuais - Horizonte de {{ state.projection_years or 30 }} Anos</h3>
        <table class="projections-table">
            <thead>
                <tr>
                    <th>Ano</th>
                    <th>Idade</th>
                    <th>Sal√°rio</th>
                    {% if is_cd %}
                    <th>Contribui√ß√£o</th>
                    <th>Saldo</th>
                    <th>Rendimento</th>
                    {% else %}
                    <th>Benef√≠cio</th>
                    <th>RMBA</th>
                    <th>Contribui√ß√£o</th>
                    {% endif %}
                    <th>Sobreviv√™ncia</th>
                </tr>
            </thead>
            <tbody>
                {% set proj_length = results.projection_years | safe_length %}
                {% if proj_length > 0 %}
                    {% for i in range(proj_length) %}
                    <tr>
                        <td>{{ results.projection_years[i] if results.projection_years and i < results.projection_years | safe_length else (2024 + i) }}</td>
                        <td>{{ state.age + i }}</td>
                        <td>{{ results.projected_salaries_by_age[i] | currency(0) if results.projected_salaries_by_age and i < (results.projected_salaries_by_age | safe_length) else (results.projected_salaries[i] | currency(0) if results.projected_salaries and i < (results.projected_salaries | safe_length) else '-') }}</td>
                        {% if is_cd %}
                        <td>{{ results.projected_contributions[i] | currency(0) if results.projected_contributions and i < (results.projected_contributions | safe_length) else '-' }}</td>
                        <td>{{ results.accumulated_reserves[i] | currency(0) if results.accumulated_reserves and i < (results.accumulated_reserves | safe_length) else '-' }}</td>
                        <td>{{ ((results.accumulated_reserves[i] or 0) * (state.accrual_rate or 5) / 100) | currency(0) if results.accumulated_reserves and i < (results.accumulated_reserves | safe_length) else '-' }}</td>
                        {% else %}
                        <td>{{ results.projected_benefits_by_age[i] | currency(0) if results.projected_benefits_by_age and i < (results.projected_benefits_by_age | safe_length) else (results.projected_benefits[i] | currency(0) if results.projected_benefits and i < (results.projected_benefits | safe_length) else '-') }}</td>
                        <td>{{ results.projected_rmba_evolution[i] | currency(0) if results.projected_rmba_evolution and i < (results.projected_rmba_evolution | safe_length) else '-' }}</td>
                        <td>{{ results.projected_contributions[i] | currency(0) if results.projected_contributions and i < (results.projected_contributions | safe_length) else '-' }}</td>
                        {% endif %}
                        <td>{{ ((results.survival_probabilities[i] or 0) * 100) | percentage(1) if results.survival_probabilities and i < (results.survival_probabilities | safe_length) else '-' }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="{% if is_cd %}6{% else %}6{% endif %}" style="text-align: center; color: #666;">
                            Dados de proje√ß√£o n√£o dispon√≠veis
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>


    <div class="page-break"></div>

    <!-- P√°gina 4: Diagn√≥sticos e Conclus√µes T√©cnicas -->
    <h2>üîç Diagn√≥sticos T√©cnicos e Recomenda√ß√µes</h2>

    <!-- Valida√ß√£o das Premissas -->
    <div class="methodology-section">
        <h3>Valida√ß√£o da Base T√©cnica</h3>

        <div class="two-column">
            <div>
                <h4>Premissas Demogr√°ficas</h4>
                <div class="diagnostic good">
                    <p><strong>T√°bua de Mortalidade:</strong> {{ state.mortality_table }} √© apropriada para a popula√ß√£o brasileira e est√° atualizada.</p>
                </div>

                <div class="diagnostic {{ 'warning' if state.mortality_aggravation else 'good' }}">
                    <p><strong>Suaviza√ß√£o:</strong>
                    {% if state.mortality_aggravation %}
                    Aplicada {{ state.mortality_aggravation | percentage }} - verificar justificativa t√©cnica.
                    {% else %}
                    N√£o aplicada - adequado para popula√ß√£o padr√£o.
                    {% endif %}
                    </p>
                </div>
            </div>

            <div>
                <h4>Premissas Econ√¥micas</h4>
                <div class="diagnostic {{ 'good' if state.discount_rate >= 0.04 and state.discount_rate <= 0.08 else 'warning' }}">
                    <p><strong>Taxa de Desconto:</strong> {{ (state.discount_rate * 100) | percentage }}
                    {% if state.discount_rate >= 0.04 and state.discount_rate <= 0.08 %}
                    est√° dentro da faixa recomendada (4-8% a.a. real).
                    {% else %}
                    deve ser revisada conforme cen√°rio econ√¥mico atual.
                    {% endif %}
                    </p>
                </div>

                <div class="diagnostic {{ 'good' if state.salary_growth_real >= 0.01 and state.salary_growth_real <= 0.04 else 'warning' }}">
                    <p><strong>Crescimento Salarial:</strong> {{ (state.salary_growth_real * 100) | percentage }}
                    {% if state.salary_growth_real >= 0.01 and state.salary_growth_real <= 0.04 %}
                    consistente com expectativas de produtividade.
                    {% else %}
                    pode ser otimista/conservador demais.
                    {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recomenda√ß√µes T√©cnicas -->
    <div class="methodology-section">
        <h3>Recomenda√ß√µes T√©cnicas</h3>

        {% if is_cd %}
        <h4>Plano de Contribui√ß√£o Definida</h4>
        <ul style="font-size: 9px; margin-left: 1em;">
            <li><strong>Monitoramento:</strong> Revisar rentabilidade anualmente e ajustar estrat√©gia de investimento se necess√°rio</li>
            <li><strong>Contribui√ß√µes:</strong> Considerar aumentos graduais da taxa de contribui√ß√£o para melhorar adequa√ß√£o</li>
            <li><strong>Modalidade:</strong> {{ 'Equival√™ncia atuarial oferece prote√ß√£o contra longevidade' if state.cd_conversion_mode == 'ACTUARIAL_EQUIVALENT' else 'Considerar modalidade de equival√™ncia atuarial para prote√ß√£o contra longevidade' }}</li>
            <li><strong>Educa√ß√£o:</strong> Implementar programa de educa√ß√£o financeira para participantes</li>
        </ul>
        {% else %}
        <h4>Plano de Benef√≠cio Definido</h4>
        <ul style="font-size: 9px; margin-left: 1em;">
            <li><strong>Equil√≠brio:</strong> {{ 'Manter monitoramento regular das reservas' if results.deficit_surplus >= 0 else 'Implementar plano de equacionamento do d√©ficit atuarial' }}</li>
            <li><strong>Contribui√ß√µes:</strong> {{ 'Taxa atual adequada' if results.required_contribution_rate <= state.contribution_rate * 1.1 else 'Considerar aumento gradual da taxa de contribui√ß√£o' }}</li>
            <li><strong>Premissas:</strong> Revisar anualmente as premissas atuariais, especialmente em cen√°rios de mudan√ßa econ√¥mica</li>
            <li><strong>Gest√£o de Riscos:</strong> Diversificar investimentos e implementar hedge para riscos de longevidade</li>
        </ul>
        {% endif %}

        <h4>Recomenda√ß√µes Gerais</h4>
        <ul style="font-size: 9px; margin-left: 1em;">
            <li><strong>Avalia√ß√£o Atuarial:</strong> Realizar avalia√ß√µes anuais com atu√°rio qualificado</li>
            <li><strong>Estresse Testing:</strong> Implementar testes de estresse para cen√°rios adversos</li>
            <li><strong>Compliance:</strong> Manter conformidade com regulamenta√ß√µes da PREVIC/SUSEP</li>
            <li><strong>Transpar√™ncia:</strong> Comunicar resultados aos participantes de forma clara e regular</li>
        </ul>
    </div>

    <!-- Gr√°fico de Fluxo de Caixa -->
    {% if charts.cash_flow %}
    <div class="chart-container no-break">
        <h3>Fluxo de Caixa Projetado</h3>
        <img src="{{ charts.cash_flow }}" alt="Fluxo de Caixa">
    </div>
    {% endif %}

    <!-- Conclus√£o T√©cnica -->
    <div class="methodology-section">
        <h3>Conclus√£o T√©cnica</h3>
        {% if is_cd %}
        <p style="font-size: 10px;">
            A simula√ß√£o do plano de contribui√ß√£o definida projeta acumula√ß√£o de <strong>{{ (results.individual_balance or 0) | currency(0) }}</strong>
            at√© a aposentadoria, resultando em taxa de reposi√ß√£o de <strong>{{ (results.replacement_ratio or 0) | percentage(1) }}</strong>.
            {% set repl_ratio = results.replacement_ratio or 0 %}
            {% if repl_ratio >= 70 %}
            O resultado indica adequa√ß√£o da estrat√©gia atual de contribui√ß√£o e acumula√ß√£o.
            {% else %}
            Recomenda-se revis√£o da estrat√©gia para melhorar a adequa√ß√£o do benef√≠cio futuro.
            {% endif %}
        </p>
        {% else %}
        <p style="font-size: 10px;">
            A avalia√ß√£o atuarial do plano de benef√≠cio definido indica RMBA de <strong>{{ (results.rmba or 0) | currency(0) }}</strong>
            {% set def_surplus = results.deficit_surplus or 0 %}
            e {{ 'super√°vit' if def_surplus >= 0 else 'd√©ficit' }} de <strong>{{ def_surplus | currency(0) }}</strong>.
            {% set req_rate = results.required_contribution_rate or 0 %}
            {% set curr_rate = state.contribution_rate or 8 %}
            A taxa de contribui√ß√£o necess√°ria para equil√≠brio √© de <strong>{{ req_rate | percentage(1) }}</strong>,
            {{ 'abaixo' if req_rate <= curr_rate else 'acima' }} da taxa atual de <strong>{{ curr_rate | percentage(1) }}</strong>.
        </p>
        {% endif %}

        <p style="font-size: 10px;">
            As premissas utilizadas est√£o em linha com as pr√°ticas atuariais vigentes e a metodologia
            {{ state.calculation_method or 'PUC' }} √© apropriada para o tipo de plano. Recomenda-se
            monitoramento peri√≥dico e reavalia√ß√£o anual das premissas e resultados.
        </p>
    </div>

    <!-- Nota T√©cnica Final -->
    <div class="technical-note">
        <h4>üìã Nota T√©cnica e Limita√ß√µes</h4>
        <p>
            <strong>Metodologia:</strong> C√°lculos baseados em princ√≠pios atuariais reconhecidos internacionalmente,
            utilizando metodologia {{ state.calculation_method or 'PUC' }} e t√°bua {{ state.mortality_table }}.
        </p>
        <p>
            <strong>Limita√ß√µes:</strong> Resultados v√°lidos para as premissas especificadas. Varia√ß√µes nas
            condi√ß√µes econ√¥micas, demogr√°ficas ou regulat√≥rias podem impactar significativamente os resultados.
        </p>
        <p>
            <strong>Responsabilidade:</strong> Esta simula√ß√£o tem car√°ter ilustrativo. Para decis√µes definitivas,
            recomenda-se consulta a atu√°rio qualificado e conformidade com regulamenta√ß√µes aplic√°veis.
        </p>
        <p>
            <strong>Gera√ß√£o:</strong> Relat√≥rio gerado em {{ generation_date }} ‚Ä¢
            Tempo de processamento: {{ (results.computation_time_ms or 0) | round(0) }}ms ‚Ä¢
            PrevLab v1.0 ‚Ä¢ ID: {{ report_id[:8] }}
        </p>
    </div>
</body>
</html>
